
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Allow public read access to project photos, since they appear on the dashboard.
    // Allow any authenticated user to write. The business logic for *which user* can
    // update a *specific project's* photo is already handled by the Firestore security
    // rules and application code, which check for ownership before calling the upload function.
    match /project-photos/{allPaths=**} {
      allow read;
      allow write: if request.auth != null;
    }

    // Allow authenticated users to manage their own attachments within a task.
    // A more secure rule would check Firestore for task ownership/assignment,
    // but the application logic already performs these checks before initiating an upload.
    // This rule unblocks the upload action itself.
    match /attachments/{taskId}/{allPaths=**} {
      allow read;
      allow write: if request.auth != null;
    }
  }
}
